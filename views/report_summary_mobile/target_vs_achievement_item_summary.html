{{extend 'layout_report_mobile.html'}}

  <link rel="stylesheet" href="{{=URL('static', 'js_and_css/ui.theme.css')}}" type="text/css" />

  <link rel="stylesheet" href="{{=URL('static', 'js_and_css/jquery-ui.css')}}" type="text/css" />

  <link rel="stylesheet" href="{{=URL('static', 'js_and_css/style.css')}}" type="text/css" />

   <script src="{{=URL('static','js_and_css/jquery-1.8.2.js')}}"></script>

   <script src="{{=URL('static','js_and_css/jquery-ui.js')}}"></script>


<!-- ================================================================ -->
<script>

var base_url=location.protocol + "//" + location.hostname + (location.port && ":" + location.port) + "/{{=request.application}}/";



$(function() {


        var valueListStr="";

    

    $('#search_type_dc').blur(function(){

      if ($('#search_type_dc').val()=='chart_id'){

        //alert(base_url+'default/get_route_list');

        $.ajax({

            url: base_url+'depot_chart/get_chart_list',

            success: function(resStr) {

              valueListStr=resStr

            }

          });

      }else if ($('#search_type_dc').val()=='depot_id'){
        $.ajax({

            url: base_url+'depot_chart/get_depot_list',

            success: function(retStr) {

              valueListStr=retStr

            }

          });

      

      };

      

    });

   

    $('#search_value_dc').keyup(function(){

      //-------------------------

      var valueList = valueListStr.split(',');        

      var searchValue=$("#search_value_dc").val();

      

      //---------------- auto complete combo list

      var valueList_new=new Array();

      lc=0;

      i =0;

      var valueStr="";        

      while (i < valueList.length)

      {

        valueStr=valueList[i];

        i=i+1;          

        var res=valueStr.toUpperCase().match(searchValue.toUpperCase());

        if (res!=null){

          valueList_new[lc]=valueStr;

          lc=lc+1;

          if (lc==30){

            break;

          };

        }else{

          continue;

        }         

      };
 

      $( "input#search_value_dc" ).autocomplete({

        source: valueList_new

      });

    

    }); 

    

// =============================Zone Filter==================================================
// =============Zone ID autocomplete======

  var zoneListStr="";
     // alert(base_url+'report_summary_mobile/get_search_zone_id_list')
  $.ajax({

      url: base_url+'report_summary_mobile/get_search_zone_id_list',
      success: function(zoneStr) {
        zoneListStr=zoneStr
      }
    });

// ==========
$('#search_tar_zone').keyup(function(){
      // alert('ok')
      //-------------------------
      var ref_list = zoneListStr.split(',');  
      var ref_name=$("#search_tar_zone").val();
      // alert(ref_name)
      
      //---------------- auto complete combo list
      var ref_list_new=new Array();
      lc=0;
      i =0;
      var refStr="";        
      while (i < ref_list.length)
      {
        refStr=ref_list[i];
        i=i+1;          
        var res=refStr.toUpperCase().match(ref_name.toUpperCase());
        if (res!=null){
          ref_list_new[lc]=refStr;
          lc=lc+1;
          if (lc==30){
            break;
          };
        }else{
          continue;
        }         
      };
      
      //-------------- auto complete source
      $( "input#search_tar_zone" ).autocomplete({
        source: ref_list_new
      });
    
    });

// =============Region ID autocomplete======

  var regionListStr="";
     // alert(base_url+'report_summary_mobile/get_search_region_id_list')
  $.ajax({

      url: base_url+'report_summary_mobile/get_search_region_id_list',
      success: function(regionStr) {
        regionListStr=regionStr
      }
    });

// ==========
$('#search_tar_region').keyup(function(){
      // alert('ok')
      //-------------------------
      var ref_list = regionListStr.split(',');  
      var ref_name=$("#search_tar_region").val();
      // alert(ref_name)
      
      //---------------- auto complete combo list
      var ref_list_new=new Array();
      lc=0;
      i =0;
      var refStr="";        
      while (i < ref_list.length)
      {
        refStr=ref_list[i];
        i=i+1;          
        var res=refStr.toUpperCase().match(ref_name.toUpperCase());
        if (res!=null){
          ref_list_new[lc]=refStr;
          lc=lc+1;
          if (lc==30){
            break;
          };
        }else{
          continue;
        }         
      };
      
      //-------------- auto complete source
      $( "input#search_tar_region" ).autocomplete({
        source: ref_list_new
      });
    
    });

// =========================Area Filter==============================================

  var prdChartListStrArea="";
     // alert(base_url+'report_summary_mobile/get_search_area_id_list')
  $.ajax({

      url: base_url+'report_summary_mobile/get_search_area_id_list',
      success: function(areaStr) {
        prdChartListStrArea=areaStr
      }
    });

// ==========
$('#search_tar_area').keyup(function(){
      // alert('ok')
      //-------------------------
      var ref_list = prdChartListStrArea.split(',');  
      var ref_name=$("#search_tar_area").val();
      // alert(ref_name)
      
      //---------------- auto complete combo list
      var ref_list_new=new Array();
      lc=0;
      i =0;
      var refStr="";        
      while (i < ref_list.length)
      {
        refStr=ref_list[i];
        i=i+1;          
        var res=refStr.toUpperCase().match(ref_name.toUpperCase());
        if (res!=null){
          ref_list_new[lc]=refStr;
          lc=lc+1;
          if (lc==30){
            break;
          };
        }else{
          continue;
        }         
      };
      
      //-------------- auto complete source
      $( "input#search_tar_area" ).autocomplete({
        source: ref_list_new
      });
    
    });
// =========================Territory Filter=================================


  var pocketMarketIdName="";
     // alert(base_url+'report_summary_mobile/get_search_territory_id_list')
  $.ajax({

      url: base_url+'report_summary_mobile/get_search_territory_id_list',
      success: function(terrStr) {
        pocketMarketIdName=terrStr
      }
    });

// ==========
$('#search_tar_territory').keyup(function(){
      // alert('ok')
      //-------------------------
      var ref_list = pocketMarketIdName.split(',');  
      var ref_name=$("#search_tar_territory").val();
      // alert(ref_name)
      
      //---------------- auto complete combo list
      var ref_list_new=new Array();
      lc=0;
      i =0;
      var refStr="";        
      while (i < ref_list.length)
      {
        refStr=ref_list[i];
        i=i+1;          
        var res=refStr.toUpperCase().match(ref_name.toUpperCase());
        if (res!=null){
          ref_list_new[lc]=refStr;
          lc=lc+1;
          if (lc==30){
            break;
          };
        }else{
          continue;
        }         
      };
      
      //-------------- auto complete source
      $( "input#search_tar_territory" ).autocomplete({
        source: ref_list_new
      });
    
    });


// =============================================

}); 



</script>


 
<!-- ============================================== -->










<!-- ========================================================== -->
<html>
<head>
</head>
<body style="font-size:60%;"> 

<table width="500" style="margin-bottom:10px; font-weight:bold;" >    	    
<tr style="background-color:#F0FAFF">
<td width="100" >Month</td>
<td width="2" >:</td>
<td >{{=datetime.datetime.strptime(str(current_date)[0:7] + '-01', '%Y-%m-%d').strftime('%Y-%b')}}</td>
</tr>

</table>

<table width="500" style="margin-bottom:10px; font-weight:bold;" >  

<form id="form1" name="form1" method="post" action="{{=URL(c='report_summary_mobile',f='target_vs_achievement_item_summary')}}">

<tr style="background-color:#F0FAFF">
<!-- <td><span style="vertical-align:middle;"> {{#=search_form.custom.widget.from_dt_3}} To {{#=search_form.custom.widget.to_dt_3}}</span></td> -->
</tr>
<tr style="background-color:#F0FAFF">
<td>

{{if session.search_tar_zone=='' or session.search_tar_zone==None:}}
<input  name="search_tar_zone" type="text" id="search_tar_zone" size="25" value="" 
placeholder="Search Division" autocomplete="off" style="width:130px; height: 20px"/>
{{else:}}
<input  name="search_tar_zone" type="text" id="search_tar_zone" size="25" value="{{=session.search_tar_zone}}" placeholder="Search Division" autocomplete="off" style="width:130px; height: 20px"/>
{{pass}}

{{if session.search_tar_region=='' or session.search_tar_region==None:}}
<input  name="search_tar_region" type="text" id="search_tar_region" size="25" value="" 
placeholder="Search Zone" autocomplete="off" style="width:130px; height: 20px"/>
{{else:}}
<input  name="search_tar_region" type="text" id="search_tar_region" size="25" value="{{=session.search_tar_region}}" placeholder="Search Zone" autocomplete="off" style="width:130px; height: 20px"/>
{{pass}}

{{if session.search_tar_area=='' or session.search_tar_area==None:}}
<input  name="search_tar_area" type="text" id="search_tar_area" size="25" value="" 
placeholder="Search Area" autocomplete="off" style="width:130px; height: 20px"/>
{{else:}}
<input  name="search_tar_area" type="text" id="search_tar_area" size="25" value="{{=session.search_tar_area}}" placeholder="Search Area" autocomplete="off" style="width:130px; height: 20px"/>
{{pass}}

</td>
</tr>
<tr style="background-color:#F0FAFF">
<td>

{{if session.search_tar_territory=='' or session.search_tar_territory==None:}}
<input  name="search_tar_territory" type="text" id="search_tar_territory" size="25" value="" 
placeholder="Search Market" autocomplete="off" style="width:130px; height: 20px"/>
{{else:}}
<input  name="search_tar_territory" type="text" id="search_tar_territory" size="25" value="{{=session.search_tar_territory}}" placeholder="Search Market" autocomplete="off" style="width:130px; height: 20px"/>
{{pass}}

<!-- <input type="" name="" placeholder="Search Territory" style="width: 150px; height: 15px " > -->

<input type="submit" name="btn_filter_tar_vs_ach_item" id="btn_filter_tar_vs_ach_item" value="Filter"   
class="button_update" style="width: 100px; height: 20px " />

<input type="submit" name="btn_all_item" id="btn_all_item" value="All"   class="button_update" 
style="width: 100px; height: 20px " />

</td>
</tr>
</form>
</table>














{{if len(targetAchRows)==0:}}
Data not available.
{{else:}}
<table width="500" border="1" cellpadding="1" cellspacing="1" class="sample_border" >
<tr align="left" class="blackCatHead" height="20px" ;  style="font-size:12px; background-color:#E9E9E9;">
<!--<td width="50" align="left"  >Category</td> -->     

<td align="left" width="200" >Item </td>
<td width="60"   style=" text-align:center;" >Target (Qty)</td>
<td width="60"   style=" text-align:center;" >Ach. (qty)</td> 
<td width="60"   style=" text-align:center;" >Ach. (%)</td>  
<td width="10"   style=" text-align:center;" ></td>    
</tr>

{{totalTgt=0}}
{{totalAch=0}}
{{AchPer=0}}
{{i=0}}

{{for cRow in range(len(itemCatRows)):}}
{{itemCatRowsS=itemCatRows[cRow]}}
{{category_id=str(itemCatRowsS['cat_type_id'])}}                
<tr  align="left" class="blackCat"  style="vertical-align:middle; font-size:11px; background-color:#cceeff">                    
<td style="text-align:left;" colspan="5">{{=category_id}}</td>
</tr>            
{{for row in range(len(targetAchRows)):}}  
{{targetAchRowsS=targetAchRows[row]}}                  
{{if targetAchRowsS['category_id']==category_id:}}
{{totalTgt+=targetAchRowsS['target_qty']}}
{{totalAch+=targetAchRowsS['achievement_qty']}}

{{
if targetAchRowsS['target_qty']>0:
AchPer=(float(targetAchRowsS['achievement_qty'])/float(targetAchRowsS['target_qty'])*100)
else:
AchPer=0                 
pass
}}
{{i+=1}}
<form action="{{=URL(c='report_summary_mobile',f='target_vs_achievement_item_summary',vars=dict(category_id=category_id,item_name=targetAchRowsS['item_name'],item_id=targetAchRowsS['item_id']))}}" method="post">
{{if i%2==0:}}
<tr  align="left" class="blackCat"  style="vertical-align:middle; font-size:11px; background-color:#F0FAFF">
{{else:}}
<tr  align="left" class="blackCat"  style="vertical-align:middle; font-size:11px;">
{{pass}}
<!--<td style=" text-align:left;"></td>-->
<td style=" text-align:left;">{{=targetAchRowsS['item_name']}}|{{=targetAchRowsS['item_id']}}</td> 
<td style=" text-align:center;">{{=targetAchRowsS['target_qty']}}</td>
<td style=" text-align:center;">{{=targetAchRowsS['achievement_qty']}}</td>
<td style=" text-align:center;">{{=round(AchPer,2)}}%</td>
<td style=" text-align:center;"><input type="submit" name="btn_submit" value=" >> "/></td>             
</tr>
</form>
{{pass}}
{{pass}} 
{{pass}}           
<!--<tr  align="left" class="blackCat"  style="vertical-align:middle; font-size:11px; background-color:#F4F4F4;">
<td colspan="2"  style=" text-align:right;">Total=</td> 
<td style=" text-align:center;">{{=totalTgt}}</td>
<td style=" text-align:center;">{{=totalAch}}</td> 
<td style=" text-align:right;"></td>            
</tr>-->
</table>
{{pass}}

</body>
</html>

