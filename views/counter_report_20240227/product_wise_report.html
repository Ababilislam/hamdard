{{extend 'layout_report.html'}}

<html>

<head>

</head>
<body>


<div class="blackCatTitle">&nbsp; Product Wise Report</div>       
    <br>
    <table width="900" class="sample_border" >
        <tr style="background-color:#E6E6E6;">
            <td width="100" >Date Range</td>
            <td width="200" >Branch</td>
            <td width="150" >Physician</td>
            <td width="100" >Discount Type</td>
            <td width="50" >Status</td>
            <td width="150" >Item</td>
            
        </tr>
        <tr style="background-color:#F0FAFF">
            <td width="200" >							
            {{=from_dt}} <b> To</b> {{=to_dt}}</td>
            <td width="100" align="left" valign="top">
            {{=branch_id}}|{{=branch_name}} </td>
            <td width="150" >                           
            {{=physician_id}}|{{=physician_name}}</td>
            <td width="150" >                           
            {{=discount_type_id}}<b> </td>
            <td width="150" >                           
            {{=status_id}}</td>
            <td width="150" >                           
            {{=item_id}}|{{=item_name}}<b> </td>

        </tr>
    </table>

 <br/>
	<table width="900px" border="1" cellpadding="1" cellspacing="1" class="sample_border" >
		  <tr align="left" class="blackCatHead"  height="20px" style="background:#E9E9E9" >
		    <td width="70" >SL</td>
		    <td width="70" >Item Id</td>
		    <td  width="150" >Item Name</td>
		    <td  width="80" >Item per/Unit </td>
		    <td  width="80" align="center">Qty</td>
            <td  width="80" align="center">Return</td>
		        <td  width="80" align="center">Net</td>
            <td  width="80" align="center">Box</td>
            <td  width="80" align="center">Strip</td>
	      </tr>

            {{#=(len(recordsCounter))}}
          {{
            order_sl_counter=0
            item_id=''
            item_name=''
            quantity= 0
            box = 0
            strip = 0
            net= 0

            for i in range(len(recordsCounter)):
                recordStr = recordsCounter[i]
                id = str(recordStr['id'])
                order_sl_counter = str(recordStr['order_sl_counter'])
                item_id = str(recordStr['item_id'])
                item_name = str(recordStr['item_name'])
                quantity = int(recordStr['quantity'])
                
            }} 


      <tr  align="left" class="blackCat"  style="vertical-align:middle; font-size:10px;">
        <td  >{{=order_sl_counter}}</td>
        <td  >{{=item_id}}</td>
        <td  >{{=item_name}}</td>
        {{
                item_per_unit_sql =f"select item_per_unit from sm_item where item_id='{item_id}' group by item_id;"
                item_per_unit = db.executesql(item_per_unit_sql,as_dict=True)
                item_unit=0
                for r in range(len(item_per_unit)):
                    itemStr = item_per_unit[r]
                    item_unit = str(itemStr['item_per_unit'])
        }}
        
        <td  align="center">{{=item_unit}}</td>
        <td  align="center">{{=quantity}}</td>

        {{
                invoice_return_sql = f"select quantity as r_quantity from invoice_counter_return where cid = '{session.cid}' and depot_id = '{branch_id}' and order_sl_counter='{order_sl_counter}' and item_id='{item_id}' group by item_id;"
                invoice_return = db.executesql(invoice_return_sql,as_dict=True)
                return_inv= 0
                for d in range(len(invoice_return)):
                    returnStr = invoice_return[d]
                    return_inv = int(returnStr['r_quantity'])

        }}

        {{pass}}
        {{
            net = (quantity-return_inv)
            box=int(int(net)/int(item_unit))
            strip=int(int(net)%int(item_unit))
        }}
        {{pass}}
        <td  align="center">{{=return_inv}}</td>
        <td  align="center">{{=net}}</td>
        <td  align="center">{{=box}}</td>
        <td  align="center">{{=strip}}</td>
        </tr>

    {{pass}}
	  </table>		 

</table>

<br/>




<br/>



</body>
</html>

