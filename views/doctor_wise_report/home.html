{{extend 'layout_mobile.html'}}

<head>
<link rel="stylesheet" href="{{=URL('static', 'js_and_css/ui.theme.css')}}" type="text/css" />
<link rel="stylesheet" href="{{=URL('static', 'js_and_css/jquery-ui.css')}}" type="text/css" />
<link rel="stylesheet" href="{{=URL('static', 'js_and_css/style.css')}}" type="text/css" />
<script src="{{=URL('static','js_and_css/jquery-1.8.2.js')}}"></script>
<script src="{{=URL('static','js_and_css/jquery-ui.js')}}"></script>
<style type="text/css">

 input[type=number]{
    margin: 2px 0px 2px 0px;
    width:100%;
}
.page_color,body{
    font-family:Arial, Helvetica, sans-serif;
    font-size:12px;
}
input[type=submit]{
    background-color:#3399ff;
    color:#FFF;
    width:100%;
    height:25px;
    border-radius:10px; 
    }

 </style>


<script> 
var base_url=location.protocol + "//" + location.hostname + (location.port && ":" + location.port) + "/{{=request.application}}/";

function getZone(k){    
    // alert('Hello')
    var pr_region=$("#pr_region"+k).val();
    $("#pr_zone"+k).empty();
    $("#pr_area"+k).empty();
    $("#pr_territory"+k).empty();   
    $("#pr_pocket_market"+k).empty();   
     
    alert(base_url+'pr_report/get_zone?region='+pr_region)

    $.ajax({
          url: base_url+'doctor_wise_report/get_zone?region='+pr_region,
          success: function(resStr) {
              retStr1=resStr.split("<rd>");
              // alert(retStr1)
              retStrLen=retStr1.length;
              var combStr='<option  value="">ALL</option>';
              for(i=0;i<retStrLen;i++){
                  retStr2=retStr1[i].split('<fd>');               
                  combStr+='<option value="'+retStr2[0]+'">'+retStr2[1]+'</option>';
                  }
              $("#pr_zone"+k).empty();
              $("#pr_zone"+k).append(combStr);
              zone_count = length(combStr)
              alert(zone_count)
          }
        });
    }

//------------ get area
function getArea(k){    
    // var pr_region=$("#pr_region"+k).val();
    var pr_zone=$("#pr_zone"+k).val();
    $("#pr_area"+k).empty();
    $("#pr_territory"+k).empty();
    $("#pr_pocket_market"+k).empty(); 
    // alert(base_url+'doctor_wise_report/get_area?zone='+pr_zone)
    $.ajax({
          // url: base_url+'doctor_wise_report/get_area?region='+pr_region+'&zone='+pr_zone,
          url: base_url+'doctor_wise_report/get_area?zone='+pr_zone,
          success: function(resStr) {
              retStr1=resStr.split("<rd>");
              retStrLen=retStr1.length; 
              var combStr='<option value="">ALL</option>';        
              for(i=0;i<retStrLen;i++){
                  retStr2=retStr1[i].split('<fd>');               
                  combStr+='<option value="'+retStr2[0]+'">'+retStr2[1]+'</option>';
                  }
              $("#pr_area"+k).append(combStr);
          }
        });
}

//------------ get area
function getTerritory(k){
    // var pr_region=$("#pr_region"+k).val();
    // var pr_zone=$("#pr_zone"+k).val();
    var pr_area=$("#pr_area"+k).val();
    $("#pr_territory"+k).empty();
    $("#pr_pocket_market"+k).empty(); 

    $.ajax({
          url: base_url+'doctor_wise_report/get_territory?area='+pr_area,
          success: function(resStr) {
              retStr1=resStr.split("<rd>");
              retStrLen=retStr1.length;           
              var combStr='<option value="">ALL</option>';
              for(i=0;i<retStrLen;i++){
                  retStr2=retStr1[i].split('<fd>');               
                  combStr+='<option value="'+retStr2[0]+'">'+retStr2[1]+'</option>';
                  }
              $("#pr_territory"+k).empty(); 
              $("#pr_territory"+k).append(combStr);
          }
        });
}

//------------ get pocket market
function getpocket_market(k){
    // var pr_region=$("#pr_region"+k).val();
    // var pr_zone=$("#pr_zone"+k).val();
    // var pr_area=$("#pr_area"+k).val();
    var pr_territory=$("#pr_territory"+k).val();
    $("#pr_pocket_market"+k).empty(); 

    // alert(base_url+'doctor_wise_report/get_pocket_market?region='+pr_region+'&zone='+pr_zone+'&area='+pr_area+'&territory='+pr_territory)

    $.ajax({
          url: base_url+'doctor_wise_report/get_pocket_market?territory='+pr_territory,
          success: function(resStr) {
              retStr1=resStr.split("<rd>");
              retStrLen=retStr1.length;           
              var combStr='<option value="">ALL</option>';
              for(i=0;i<retStrLen;i++){
                  retStr2=retStr1[i].split('<fd>');               
                  combStr+='<option value="'+retStr2[0]+'">'+retStr2[1]+'</option>';
                  }
              $("#pr_pocket_market"+k).empty(); 
              $("#pr_pocket_market"+k).append(combStr);

          }
        });
}

</script>
 
</head>

<body >   

<table style="border-collapse:collapse;width:100%;">
    <tr style="background-color:#ECF4FD; font-weight:bold; font-size:14px;" >
        <td align="center" style="width:100%;">Doctor Wise Report</td></tr>
    </tr>
</table>


<div style="width: 95%;height: 60px;margin-top:10px;margin-right: 10px;">
    <table width="100%" style="margin:10px;">
        <tr align="center" style="height:25%;">
            <td style="background-color: #D8ECCB;">{{=session.division_count}}</td>
            <td></td>
            <td style="background-color: #D8ECCB;">{{=session.zone_count}}</td>
            <td></td>
            <td style="background-color: #D8ECCB;">{{=session.area_count}}</td>
            <td></td>
            <td style="background-color: #D8ECCB;">{{=session.territory_count}}</td>
        </tr>
        <tr align="center" style="height:25%;">
            <td style="background-color: #7DC84A;">Divison</td>
            <td></td>
            <td style="background-color: #7DC84A;">Zone</td>
            <td></td>
            <td style="background-color: #7DC84A;">Area</td>
            <td></td>
            <td style="background-color: #7DC84A;">Market</td>
        </tr>
    </table>
</div>



<table style="border-collapse:collapse; width:100%;">
    <form action="{{=URL(c='doctor_wise_report',f='index')}}" >     
    <tr >
        <td>Date Range(max 1 month):<span style="color:red;">*</span></td>
        <td style="width:25%;">
            {{if session.from_date==None:}}
                <input type="text" class="date" name="from_date" placeholder="From Date" style=" width:80px;"/>
            {{else:}}
                <input type="text" class="date" name="from_date" value="{{=session.from_date}}" style=" width:80px;"/>
            {{pass}}
        To &nbsp; &nbsp;
            {{if session.to_date==None:}}
                <input type="text" class="date" name="to_date" placeholder="To Date" style=" width:80px;"/>
            {{else:}}
                <input type="text" class="date" name="to_date" value="{{=session.to_date}}" style=" width:80px;"/>
            {{pass}}
        </td>
        <td style="width:60%;"></td>
     </tr>
     {{=session.level_depth_no}}

     {{if session.level_depth_no == 0 :}} 
     <tr>
        <td>Division:<span style="color:red;" >*</span></td>
        <td style="width:25%;">
            <select id= "pr_region4" name="pr_region4" style="width:220px" required onChange="getZone(4)">
                {{#if session.sch_level_search == '' or session.sch_level_search == 'None' or session.sch_level_search == None : }}
                    <option value="">Select Division</option>
                    {{for k in range(len(division_list)):}}

                        {{level_list_z=division_list[k]}} 
                        {{divsion_value = level_list_z['division_id']}}              
                            
                         {{if level_list_z['division_id']==session.sch_level_search:}}                  
                            <option value="{{=level_list_z['division_id']}}" selected >{{=level_list_z['division_name']}}</option>
                         {{else:}}
                            <option value="{{=level_list_z['division_id']}}" >{{=level_list_z['division_name']}}</option>
                         {{pass}}   
                    
                    {{pass}}
                {{#else:}}
                <!-- <option value="">Select Division</option> -->
                <!-- <option value="{{#=session.sch_level_search}}">{{#=session.sch_level_search}}</option> -->
                {{#pass}}
                
            </select>
        </td>
        <td style="width:60%;"></td>
     </tr>    
     <tr >
         <td>Zone :{{=session.sch_zone_search}}</td>
         <td style="width:25%;">
            {{if session.sch_zone_search == '' or session.sch_zone_search == 'None' or session.sch_zone_search == None :}}
             <select id="pr_zone4" name="pr_zone4" style="width:220px" onChange="getArea(4)">
             </select>
                {{else:}}
                <select id="pr_zone4" name="pr_zone4" style="width:220px" onChange="getArea(4)">
                <option value="{{=session.sch_zone_search}}">{{=session.sch_zone_search}}</option>
                </select>
                {{pass}}
         </td>
         <td></td>
     </tr>
     <tr >
         <td>Area :</td>
         <td style="width:25%;">
             <select id="pr_area4" name="pr_area4" style="width:220px" onChange="getTerritory(4)">
             </select>
         </td>
     </tr>
    <tr >
         <td>Market</td>
         <td style="width:25%;">
             <select id="pr_territory4" name="pr_territory4" style="width:220px" onChange = "getpocket_market(4)" >            
             </select>
         </td>
     </tr>
     <tr >
         <td>Pocket Market</td>
         <td style="width:25%;">
             <select id="pr_pocket_market4" name="pr_pocket_market4" style="width:220px" >                    
             </select>
         </td>
     </tr>

     {{elif session.level_depth_no == 1:}} 
     <tr>
        <td>Zone:<span style="color:red;">*</span></td>
        <td>
            <select name="pr_zone4" id="pr_zone4" required style="width:220px" onChange="getArea(4)">
                <option value="">Select Zone</option>
                    {{for k in range(len(zone_list)):}}

                        {{level_list_z=zone_list[k]}}               
                            
                         {{if level_list_z['zone_id']==session.sch_zone_search:}}                  
                            <option value="{{=level_list_z['zone_id']}}" selected >{{=level_list_z['zone_name']}}</option>
                         {{else:}}
                            <option value="{{=level_list_z['zone_id']}}" >{{=level_list_z['zone_name']}}</option>
                         {{pass}}   
                    
                    {{pass}}
            </select>
        </td>
        <td style="width:60%;"></td>
     </tr>  
     <tr >
         <td>Area :</td>
         <td style="width:25%;">
            {{if session.sch_area_search == '' or session.sch_area_search == 'None' or session.sch_area_search == None :}}
             <select id="pr_area4" name="pr_area4" style="width:220px" onChange="getTerritory(4)">                    
             </select>
             {{else:}}
              <select id="pr_area4" name="pr_area4" style="width:220px" onChange="getTerritory(4)">     
              <option value="{{=session.sch_area_search}}">{{=session.sch_area_search}}</option>               
             </select>
             {{pass}}
         </td>
     </tr>
    <tr >
         <td>Market</td>
         <td style="width:25%;">
            {{if session.sch_territory == '' or session.sch_territory == 'None' or session.sch_territory == None :}}
             <select id="pr_territory4" name="pr_territory4" style="width:220px" onChange = "getpocket_market(4)" >                    
             </select>
             {{else:}}
             <select id="pr_area4" name="pr_area4" style="width:220px" onChange="getTerritory(4)">     
              <option value="{{=session.sch_territory}}">{{=session.sch_territory}}</option>               
             </select>
             {{pass}}
         </td>
     </tr>
     <tr >
         <td>Pocket Market</td>
         <td style="width:25%;">
             <select id="pr_pocket_market4" name="pr_pocket_market4" style="width:220px" >                    
             </select>
         </td>
     </tr>  

    {{elif session.level_depth_no == 2 :}}

        <tr>
            <td>Area:<span style="color:red;">*</span></td>
            <td>
                <select id="pr_area4" name="pr_area4" required  style="width:220px" onChange="getTerritory(4)">
                    <option value="">Select Area</option>
                    {{for j in range(len(area_list)):}}
                         
                         {{level_list_s=area_list[j]}}               
                        
                        {{if level_list_s['area_id']==session.sch_area_search:}}           
                            <option value="{{=level_list_s['area_id']}}" selected >{{=level_list_s['area_name']}}</option>
                        {{else:}}
                            <option value="{{=level_list_s['area_id']}}" >{{=level_list_s['area_name']}}</option>
                        {{pass}}   
                    
                    {{pass}}
                </select>
            </td>
            <td style="width:60%;"></td>
         </tr>
         <tr >
         <td>Market</td>
         <td style="width:25%;">
             <select id="pr_territory4" name="pr_territory4" style="width:220px" onChange = "getpocket_market(4)" >                    
             </select>
         </td>
     </tr>
     <tr >
         <td>Pocket Market</td>
         <td style="width:25%;">
             <select id="pr_pocket_market4" name="pr_pocket_market4" style="width:220px" >                    
             </select>
         </td>
     </tr>  

        {{ elif session.user_type == 'rep' :}}
        <tr>
            <td>Market</td>
            <td>
                <select id="pr_territory4" name="pr_territory4"  style="width:220px"  onChange = "getpocket_market(4)">
                <option value="">Select Market</option>
                    {{for i in range(len(level_area_list)):}}
                        {{level_area_list_s=level_area_list[i]}}            
                        {{if level_area_list_s['area_id']==session.sch_territory:}}                  
                <option value="{{=level_area_list_s['area_id']}}" selected >{{=level_area_list_s['area_name']}}</option>
                        {{else:}}
                <option value="{{=level_area_list_s['area_id']}}" >{{=level_area_list_s['area_name']}}</option>
                        {{pass}}   
                    {{pass}}
                </select>
            </td>
            <td style="width:60%;"></td>
        </tr>
        <tr >
             <td>Pocket Market</td>
             <td style="width:25%;">
                 <select id="pr_pocket_market4" name="pr_pocket_market4" style="width:220px" >                    
                 </select>
             </td>
        </tr>  
        {{pass}}

     <tr>
        <td>Doctor Type:</td>
        <td>
            <select name="sch_rx_type" style="width:220px">
                <option value="">Select Doctor Type</option>
                {{for i in range(len(doctor_type_record)):}}
                     {{seen_rx_type_list_s=doctor_type_record[i]}}               
                    
                    {{if seen_rx_type_list_s['doc_type_name']==session.sch_rx_type_search:}}                  
                        <option value="{{=seen_rx_type_list_s['doc_type_name']}}" selected >{{=seen_rx_type_list_s['doc_type_name']}}</option>
                    {{else:}}
                        <option value="{{=seen_rx_type_list_s['doc_type_name']}}" >{{=seen_rx_type_list_s['doc_type_name']}}</option>
                    {{pass}}   
                {{pass}}
            </select>
        </td>
        <td style="width:60%;"></td>
     </tr>

        
    <tr>
        <td>Product:</td>
        <td>

            <select name="search_item_id_name" style="width:220px">
                <option value="">Select Product</option>
                {{for rec_item in rec_item:}}               
                    {{if rec_item.brand_name==session.search_item_id_name_search:}}                  
                        <option value="{{=rec_item.brand_name}}" selected >{{=rec_item.brand_name}}</option>
                    {{else:}}
                        <option value="{{=rec_item.brand_name}}" >{{=rec_item.brand_name}}</option>
                    {{pass}}      
                      
                {{pass}}
            </select>

    </td>
    <td style="width:60%;"></td>
     </tr>
     <tr style="border-bottom:2px solid #E6E6E6;">
        <td align="right" style=" text-align:left;">
            <input type="submit" name="btn_report" value="Show" style="height:40px; width:100px"/>
        </td>
        <td width="100px" style="text-align:left;">
            <input type="submit" name="btn_reset" value="Reset" style="height:40px; width: 100px;background-color: #999E97;"/>
        </td>
        <td style="width:60%;"></td>
    </tr>

     </form>
</table>



<table style="border-collapse:collapse; width:100%;">   

    <tr style="background-color:#ECF4FD; font-size:10px;border-bottom:1px solid #E6E6E6;">
        <td width="50%" style="text-align:left;">Rx Count : {{=rx_u_count}}&nbsp; &nbsp;</td>
        <td width="50%" style="text-align:right;">Doctor Count : {{=doctor_recordsH}}&nbsp; &nbsp;</td>
    </tr>
</table>

  
</body>

{{if (session.btn_report=='YES'):}}
{{if not records:}}
    Please complete Mandatory fields to show Data
{{else:}}
{{#if (session.sch_area!=''):}}
<table style="border-collapse:collapse; width:100%;">     
    <tr style="background-color:#0099ff; color:#FFF; font-size:10px;border-bottom:1px solid #E6E6E6;">
        <!-- <td  >Zone</td>
        <td  >Region</td> 
         <td  >Area </td>   -->     
       <!-- <td >Area ID</td> -->
        <td  >Market</td>
        <td >Submitted By</td>
        <td >Doctor Name</td>
        <td  align="center" >Count</td>
        <td  align="center" ></td>
    </tr>
    {{for row in records:}}
    
    {{
    #area_name=''
    #for i in range(len(level_area_list)):
    #    level_area_list_s=level_area_list[i]                               
    #    if level_area_list_s['area_id']==row[db.sm_prescription_seen_details.area_id]:
    #        areaId=level_area_list_s['area_id']
     #       area_name=level_area_list_s['area_name']
     #   pass   
    #pass
        submited_id = row[db.sm_prescription_seen_details.submit_by_id]
        area_id = row[db.sm_prescription_seen_details.area_id]
        doctor_id = row[db.sm_prescription_seen_details.doctor_id]
        doctor_name = row[db.sm_prescription_seen_details.doctor_name]
        #doc_type = row[db.sm_prescription_seen_head.doc_type_name]
        #submited_id = row[db.sm_prescription_seen_details.submit_by_id]
        
 }}
  
  <tr style="background-color:#e6f2ff; font-size:10px;border-bottom:1px solid #E6E6E6;">
        <!-- <td >{{#=row[db.sm_prescription_seen_head.zone_name]}}</td>
        <td >{{#=row[db.sm_prescription_seen_head.reg_name]}}</td>    
         <td >{{=row[db.sm_prescription_seen_head.tl_name]}}</td>   -->                 
        <!-- <td >{{#=row[db.sm_prescription_seen_head.area_id]}}</td>         -->
        <td >{{=row[db.sm_prescription_seen_head.area_name]}}</td>        
       <!-- <td >{{=row[db.sm_prescription_seen_head.rx_type]}}</td> -->
        <td >{{=row[db.sm_prescription_seen_details.submit_by_name]}}</td>
        <td >{{=row[db.sm_prescription_seen_details.doctor_name]}}</td>
        <td align="center" >{{=row[db.sm_prescription_seen_details.id.count()]}}</td>
        <form action="{{=URL(c='doctor_wise_report',f='doctor_wise_report_details', args=[submited_id, area_id, doctor_id, doc_type, doctor_name])}}" method="POST" >
            <td align="right" width="40px">
                <input type="submit" id="details_btn" name="details_btn" value=">>" style="width: 40px;">
            </td>
        </form>
    </tr>

    {{pass}}
    {{pass}}
    {{#pass}}    
    
{{pass}}
</table>

{{pass}}